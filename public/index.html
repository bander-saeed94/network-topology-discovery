<!DOCTYPE html>
<html>
<head>
  <title>Network Topology</title>
  <script src="/lib/vis-network/vis-network.min.js"></script>
  <link href="/lib/vis-network/vis-network.min.css" rel="stylesheet" />
  <style>
    #network {
      width: 100vw;
      height: 100vh;
      border: 1px solid lightgray;
    }
  </style>
</head>
<body>
  <div id="network"></div>
  <script>
    async function loadTopology() {
      const res = await fetch('/api/topology');  // Replace with your actual API endpoint
      const topology = await res.json();

      const nodes = new Map();
      const edges = new Set();

      topology.forEach(router => {
        nodes.set(router.routerName, {
          id: router.routerName,
          label: router.routerName,
          group: 'router'
        });

        router.neighborRouter.forEach(n => {
          const target = topology.find(r => r.interfaces.some(i => i.ip === n.ip));
          const to = target ? target.routerName : n.ip;
          edges.add(`${router.routerName}->${to}`);
          nodes.set(to, {
            id: to,
            label: to,
            group: 'router'
          });
        });

        router.host.forEach(h => {
          const hostId = h.ip;
          nodes.set(hostId, {
            id: hostId,
            label: h.ip,
            group: 'host'
          });
          edges.add(`${router.routerName}->${hostId}`);
        });
      });

      const data = {
        nodes: Array.from(nodes.values()),
        edges: Array.from(edges).map(e => {
          const [from, to] = e.split('->');
          return { from, to };
        })
      };

      const container = document.getElementById('network');
      const options = {
        groups: {
          router: { shape: 'box', color: '#ADD8E6' },
          host: { shape: 'ellipse', color: '#FFDD99' }
        },
        layout: { improvedLayout: true },
        physics: { stabilization: true }
      };

      new vis.Network(container, data, options);
    }

    loadTopology();
  </script>
</body>
</html>
